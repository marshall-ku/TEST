name: Send slack notification

on:
  workflow_call:
    inputs:
      status:
        description: "Status of job"
        required: true
        type: string
      title:
        description: "Title of attachment"
        required: false
        default: "Failed to run job"
        type: string
      message:
        description: "Message to send"
        required: true
        type: string
      author:
        description: "Author of attachment"
        required: false
        default: "Github Actions"
        type: string
    secrets:
      url:
        description: "Slack webhook url"
        required: true

jobs:
  run:
    name: Send notification
    runs-on: ubuntu-latest
    steps:
      - name: Make curl request
        run: |
          json_payload=$(cat << EOF
          {
            color=$([ "${{ inputs.status }}" == 'true' ] && echo '#66bb6a' || echo '#f44336')
            "attachments": [
                {
                    "color": "$color",
                    "author_name": "${{ inputs.author }}",
                    "author_icon": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",
                    "title": "${{ inputs.title }}",
                    "title_link": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                    "text": "${{ inputs.message }}",
                    "fields": [
                        {
                            "title": "필드",
                            "value": "value",
                            "short": false
                        }
                    ]
                }
            ]
          }
          EOF
          )
          curl -X POST -H "Content-Type:application/json" -d "$json_payload" ${{ secrets.url }}
